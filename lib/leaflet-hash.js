(function(e){var t=function(){var t=e.documentMode;return"onhashchange"in e&&(t===undefined||t>7)}();L.Hash=function(e){this.onHashChange=L.Util.bind(this.onHashChange,this);if(e){this.init(e)}};L.Hash.prototype={map:null,lastHash:null,parseHash:function(e){if(e.indexOf("#")===0){e=e.substr(1)}var t=e.split("/");if(t.length==3){var n=parseInt(t[0],10),r=parseFloat(t[1]),i=parseFloat(t[2]);if(isNaN(n)||isNaN(r)||isNaN(i)){return false}else{return{center:new L.LatLng(r,i),zoom:n}}}else{return false}},formatHash:function(e){var t=e.getCenter(),n=e.getZoom(),r=Math.max(0,Math.ceil(Math.log(n)/Math.LN2));return"#"+[n,t.lat,t.lng,selectedDataset,selectedYear,opcty,numColorDivs,palette,splitType,graphType,rangeType].join("/")},init:function(e){this.map=e;this.lastHash=null;this.onHashChange();if(!this.isListening){this.startListening()}},remove:function(){if(this.changeTimeout){clearTimeout(this.changeTimeout)}if(this.isListening){this.stopListening()}this.map=null},onMapMove:function(){if(this.movingMap||!this.map._loaded){return false}var e=this.formatHash(this.map);if(this.lastHash!=e){location.replace(e);this.lastHash=e}},movingMap:false,update:function(){var e=location.hash;if(e===this.lastHash){return}var t=this.parseHash(e);if(t){this.movingMap=true;this.map.setView(t.center,t.zoom);this.movingMap=false}else{this.onMapMove(this.map)}},changeDefer:100,changeTimeout:null,onHashChange:function(){if(!this.changeTimeout){var e=this;this.changeTimeout=setTimeout(function(){e.update();e.changeTimeout=null},this.changeDefer)}},isListening:false,hashChangeInterval:null,startListening:function(){this.map.on("moveend",this.onMapMove,this);if(t){L.DomEvent.addListener(e,"hashchange",this.onHashChange)}else{clearInterval(this.hashChangeInterval);this.hashChangeInterval=setInterval(this.onHashChange,50)}this.isListening=true},stopListening:function(){this.map.off("moveend",this.onMapMove,this);if(t){L.DomEvent.removeListener(e,"hashchange",this.onHashChange)}else{clearInterval(this.hashChangeInterval)}this.isListening=false}};L.hash=function(e){return new L.Hash(e)};L.Map.prototype.addHash=function(){this._hash=L.hash(this)};L.Map.prototype.removeHash=function(){this._hash.remove()}})(window)